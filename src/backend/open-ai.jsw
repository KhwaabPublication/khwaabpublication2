import {fetch} from 'wix-fetch';
import {getSecret} from 'wix-secrets-backend';

export async function  getChatbotResponse(messages) {
  const instructions = "Be a Nice chatbot";
  const systemMessage = {
    role: "system",
    content: instructions,
  }

  messages = messages.unshift(systemMessage);
  return await getChatCompletion();
  
}

export async function getChatCompletion() {
    const apiKey = await getSecret("KHWAAB-PUBLICATION");
    const endpoint = "https://api.openai.com/v1/completions";
    
    const options = {
      method: "POST",
      headers: {
        'Content-Type': "application/json",
        'Authorization': `Bearer ${apiKey}`
      },
      body: JSON.stringify({
        messages:"What is the capital of delhi",
        model: "gpt-4",
        max_tokens: 1000,
      })
      
      }
     
try{
  const response = await fetch(endpoint, options);
  const data = await response.json();
  return data;
}
    catch (error){
      console.log("Error getting completion", error);
    }

    
}